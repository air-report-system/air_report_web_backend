# Replit配置文件 - Django后端部署
# 空气质量检测系统后端API

# 运行配置
run = """
chmod +x scripts/setup_replit.sh && ./scripts/setup_replit.sh && \
chmod +x scripts/start_replit.sh && ./scripts/start_replit.sh
"""

# 入口点配置
entrypoint = "manage.py"

# 模块配置
modules = ["python-3.12", "nix"]

# 隐藏文件配置
hidden = [".config", ".pythonlibs", "__pycache__", ".uv"]

# 语言配置
[languages]

[languages.python3]
pattern = "**/*.py"

[languages.python3.languageServer]
start = "pylsp"

# Nix配置 - 用于安装系统依赖
[nix]
channel = "stable-23_11"

# 部署配置 - 分离构建和运行
[deployment]
build = """
chmod +x scripts/build_replit.sh && ./scripts/build_replit.sh
"""
run = """
chmod +x scripts/run_replit.sh && ./scripts/run_replit.sh
"""
ignorePorts = false

# 环境变量配置
[env]
DJANGO_SETTINGS_MODULE = "config.settings.replit"
PYTHONPATH = "."
PYTHONUNBUFFERED = "1"
PYTHONDONTWRITEBYTECODE = "1"

# 端口配置
[[ports]]
localPort = 8000
externalPort = 80

# 健康检查配置
[deployment.healthcheck]
path = "/health"
timeout = 15
interval = 5

# Git配置
[gitHubImport]
requiredFiles = [".replit", "pyproject.toml"]

# 调试配置
[debugger]
support = true

[debugger.interactive]
transport = "localhost:5678"
startCommand = ["dap-python", "manage.py"]

[debugger.interactive.integratedAdapter]
dapTcpAddress = "localhost:5678"

# 包管理器配置
[packager]
language = "python3"
ignoredPackages = ["unit_tests"]

[packager.features]
enabledForHosting = false
packageSearch = true
guessImports = true

# 对象存储配置（如果需要）
[objectStorage]
defaultBucketID = "replit-objstore-default"
